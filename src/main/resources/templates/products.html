<!DOCTYPE html>
<html lang="en">
  <head>
    <th:block th:insert="~{fragments/head :: head}"></th:block>
    <title>Products | SmartPick</title>
    <script th:src="@{/js/products.js}" defer="defer"></script>
  </head>
  <body>
    <th:block th:insert="~{fragments/header :: header}"></th:block>
    <th:block
      th:insert="~{fragments/successMessage :: successMessage}"
    ></th:block>
    <th:block th:insert="~{fragments/errorMessage :: errorMessage}"></th:block>
    <th:block th:insert="~{fragments/infoMessage :: infoMessage}"></th:block>
    <main>
      <div class="container flex flex-col gap-8 mx-auto p-6">
        <div class="flex gap-4 text-2xl">
          <a
            th:href="@{/products/men}"
            th:class="${highlightedCategory == 'men' ? 'text-cyan-800 font-semibold' : ''}"
            >MEN</a
          >
          <a
            th:href="@{/products/women}"
            th:class="${highlightedCategory == 'women' ? 'text-cyan-800 font-semibold' : ''}"
            >WOMEN</a
          >
          <a
            th:href="@{/products/children}"
            th:class="${highlightedCategory == 'children' ? 'text-cyan-800 font-semibold' : ''}"
            >CHILDREN</a
          >
        </div>

        <div
          class="flex items-center justify-between overflow-x-auto md:overflow-x-hidden pb-6 md:pb-0"
        >
          <div class="flex gap-8">
            <th:block th:each="category : ${categories}">
              <a
                th:href="@{'/products/' + (${gender} ?: 'all') + '/' + ${category.categoryName.toLowerCase()}}"
                th:text="${category.categoryName}"
                class="hover:text-cyan-800"
              ></a>
            </th:block>
          </div>
          <form
            th:action="@{/products/search}"
            method="get"
            class="hidden md:block"
          >
            <div class="relative text-gray-600">
              <input
                class="border border-b-2 border-gray-300 bg-white h-10 px-5 pr-16 rounded-lg text-sm focus:outline-none"
                type="search"
                name="search"
                placeholder="Search"
              />
              <button type="submit" class="absolute right-0 top-0 mt-3 mr-4">
                <svg
                  class="text-gray-600 h-4 w-4 fill-current"
                  xmlns="http://www.w3.org/2000/svg"
                  xmlns:xlink="http://www.w3.org/1999/xlink"
                  version="1.1"
                  viewBox="0 0 56.966 56.966"
                  style="enable-background: new 0 0 56.966 56.966"
                  xml:space="preserve"
                >
                  <path
                    d="M55.146,51.887L41.588,37.786c3.486-4.144,5.396-9.358,5.396-14.786c0-12.682-10.318-23-23-23s-23,10.318-23,23  s10.318,23,23,23c4.761,0,9.298-1.436,13.177-4.162l13.661,14.208c0.571,0.593,1.339,0.92,2.162,0.92  c0.779,0,1.518-0.297,2.079-0.837C56.255,54.982,56.293,53.08,55.146,51.887z M23.984,6c9.374,0,17,7.626,17,17s-7.626,17-17,17  s-17-7.626-17-17S14.61,6,23.984,6z"
                  />
                </svg>
              </button>
            </div>
          </form>
        </div>
        <hr />
        <form th:action="@{/products/search}" method="get" class="md:hidden">
          <div class="relative text-gray-600">
            <input
              class="border border-b-2 border-gray-300 bg-white h-10 px-5 pr-16 rounded-lg text-sm focus:outline-none w-full"
              type="search"
              name="search"
              placeholder="Search"
            />
            <button type="submit" class="absolute right-0 top-0 mt-3 mr-4">
              <svg
                class="text-gray-600 h-4 w-4 fill-current"
                xmlns="http://www.w3.org/2000/svg"
                xmlns:xlink="http://www.w3.org/1999/xlink"
                version="1.1"
                viewBox="0 0 56.966 56.966"
                style="enable-background: new 0 0 56.966 56.966"
                xml:space="preserve"
              >
                <path
                  d="M55.146,51.887L41.588,37.786c3.486-4.144,5.396-9.358,5.396-14.786c0-12.682-10.318-23-23-23s-23,10.318-23,23  s10.318,23,23,23c4.761,0,9.298-1.436,13.177-4.162l13.661,14.208c0.571,0.593,1.339,0.92,2.162,0.92  c0.779,0,1.518-0.297,2.079-0.837C56.255,54.982,56.293,53.08,55.146,51.887z M23.984,6c9.374,0,17,7.626,17,17s-7.626,17-17,17  s-17-7.626-17-17S14.61,6,23.984,6z"
                />
              </svg>
            </button>
          </div>
        </form>
        <div class="flex items-end gap-4">
          <p class="text-3xl uppercase">
            <span th:if="${gender == null && category == null}"
              >all products</span
            >
            <span
              th:if="${gender != null && category == null}"
              th:text="${gender} + '&rsquo;s products'"
            ></span>
            <span
              th:if="${gender != null && gender != 'all' && category != null}"
              th:text="${gender} + '&rsquo;s ' + ${category}"
            ></span>
            <span
              th:if="${gender == 'all' && category != null}"
              th:text="'all ' + ${category}"
            ></span>
          </p>
          <p
            th:text="${products.size() + ' products'}"
            class="text-sm text-gray-400 whitespace-nowrap"
          ></p>
        </div>
        <div
          class="flex gap-8"
          x-data="{ openSize: false, openColor: false, openPrice: false }"
        >
          <div class="relative">
            <p
              class="flex items-center gap-1 cursor-pointer"
              @click="openSize =! openSize"
            >
              SIZE
              <svg
                xmlns="http://www.w3.org/2000/svg"
                fill="none"
                viewBox="0 0 24 24"
                stroke-width="1.5"
                stroke="currentColor"
                class="w-4 h-4"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  d="m19.5 8.25-7.5 7.5-7.5-7.5"
                />
              </svg>
            </p>
            <div
              x-show="openSize"
              class="absolute left-0 p-2 z-10 bg-white rounded-lg shadow-lg w-40 mt-2"
              x-cloak
            >
              <div class="relative">
                <a
                  href="#"
                  onclick="filterByParams({ size: 'XS' })"
                  class="block px-4 py-2 text-base hover:bg-gray-100 rounded-lg"
                  >XS</a
                >
                <a
                  href="#"
                  onclick="filterByParams({ size: 'S' })"
                  class="block px-4 py-2 text-base hover:bg-gray-100 rounded-lg"
                  >S</a
                >
                <a
                  href="#"
                  onclick="filterByParams({ size: 'M' })"
                  class="block px-4 py-2 text-base hover:bg-gray-100 rounded-lg"
                  >M</a
                >
                <a
                  href="#"
                  onclick="filterByParams({ size: 'L' })"
                  class="block px-4 py-2 text-base hover:bg-gray-100 rounded-lg"
                  >L</a
                >
                <a
                  href="#"
                  onclick="filterByParams({ size: 'XL' })"
                  class="block px-4 py-2 text-base hover:bg-gray-100 rounded-lg"
                  >XL</a
                >
              </div>
            </div>
          </div>
          <div class="relative">
            <p
              class="flex items-center gap-1 cursor-pointer"
              @click="openColor =! openColor"
            >
              COLOR
              <svg
                xmlns="http://www.w3.org/2000/svg"
                fill="none"
                viewBox="0 0 24 24"
                stroke-width="1.5"
                stroke="currentColor"
                class="w-4 h-4"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  d="m19.5 8.25-7.5 7.5-7.5-7.5"
                />
              </svg>
            </p>
            <div
              x-show="openColor"
              class="absolute left-0 p-2 z-10 bg-white rounded-lg shadow-lg w-40 mt-2"
              x-cloak
            >
              <a
                href="#"
                onclick="filterByParams({ color: 'Black' })"
                class="px-4 py-2 text-base hover:bg-gray-100 rounded-lg flex items-center gap-2"
              >
                <div class="w-4 h-4 rounded-full bg-black"></div>
                Black
              </a>
              <a
                href="#"
                onclick="filterByParams({ color: 'Blue' })"
                class="px-4 py-2 text-base hover:bg-gray-100 rounded-lg flex items-center gap-2"
              >
                <div class="w-4 h-4 rounded-full bg-blue-400"></div>
                Blue
              </a>
              <a
                href="#"
                onclick="filterByParams({ color: 'Brown' })"
                class="px-4 py-2 text-base hover:bg-gray-100 rounded-lg flex items-center gap-2"
              >
                <div class="w-4 h-4 rounded-full bg-amber-700"></div>
                Brown
              </a>
              <a
                href="#"
                onclick="filterByParams({ color: 'Gray' })"
                class="px-4 py-2 text-base hover:bg-gray-100 rounded-lg flex items-center gap-2"
              >
                <div class="w-4 h-4 rounded-full bg-gray-400"></div>
                Gray
              </a>
              <a
                href="#"
                onclick="filterByParams({ color: 'Green' })"
                class="px-4 py-2 text-base hover:bg-gray-100 rounded-lg flex items-center gap-2"
              >
                <div class="w-4 h-4 rounded-full bg-green-400"></div>
                Green
              </a>
              <a
                href="#"
                onclick="filterByParams({ color: 'Red' })"
                class="px-4 py-2 text-base hover:bg-gray-100 rounded-lg flex items-center gap-2"
              >
                <div class="w-4 h-4 rounded-full bg-red-500"></div>
                Red
              </a>
              <a
                href="#"
                onclick="filterByParams({ color: 'White' })"
                class="px-4 py-2 text-base hover:bg-gray-100 rounded-lg flex items-center gap-2"
              >
                <div class="w-4 h-4 rounded-full bg-white border"></div>
                White</a
              >
            </div>
          </div>
          <div class="relative">
            <p
              class="flex items-center gap-1 cursor-pointer"
              @click="openPrice =! openPrice"
            >
              PRICE
              <svg
                xmlns="http://www.w3.org/2000/svg"
                fill="none"
                viewBox="0 0 24 24"
                stroke-width="1.5"
                stroke="currentColor"
                class="w-4 h-4"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  d="m19.5 8.25-7.5 7.5-7.5-7.5"
                />
              </svg>
            </p>
            <div
              x-show="openPrice"
              class="absolute left-0 p-2 z-10 bg-white rounded-lg shadow-lg w-40 mt-2"
              x-cloak
            >
              <a
                onclick="filterByParams({minPrice: null, maxPrice: 10 })"
                href="#"
                class="block px-4 py-2 text-base hover:bg-gray-100 rounded-lg"
              >
                &lsaquo; 10 EUR
              </a>
              <a
                href="#"
                onclick="filterByParams({ minPrice: 10, maxPrice: 30 })"
                class="block px-4 py-2 text-base hover:bg-gray-100 rounded-lg"
                >10 - 30 EUR
              </a>
              <a
                href="#"
                onclick="filterByParams({ minPrice: 30, maxPrice: 100 })"
                class="block px-4 py-2 text-base hover:bg-gray-100 rounded-lg"
              >
                30 - 100 EUR
              </a>
              <a
                href="#"
                onclick="filterByParams({ minPrice: 100, maxPrice: null})"
                class="block px-4 py-2 text-base hover:bg-gray-100 rounded-lg"
              >
                100 EUR &rsaquo;
              </a>
            </div>
          </div>
        </div>
        <p th:if="${#lists.isEmpty(products)}" class="text-center">
          No products available.
        </p>
        <div class="grid md:grid-cols-5 gap-8">
          <div
            th:each="product : ${products}"
            class="border shadow-lg rounded-lg h-full"
          >
            <a
              th:href="'/products/' + ${product.gender.toLowerCase()} + '/' + ${product.category.categoryName.toLowerCase()} + '/' + ${product.productId}"
            >
              <div class="relative">
                <div class="p-2">
                  <img
                    th:src="${product.image}"
                    th:alt="${product.name}"
                    class="rounded-lg"
                  />
                  <div
                    th:if="${productsController.isWithinLastWeek(product.createdAt)}"
                    class="absolute top-4 left-4 bg-white rounded-lg flex gap-2 p-2 text-xs shadow-md items-center"
                  >
                    <svg
                      xmlns="http://www.w3.org/2000/svg"
                      fill="none"
                      viewBox="0 0 24 24"
                      stroke-width="1.5"
                      stroke="currentColor"
                      class="w-5 h-5"
                    >
                      <path
                        stroke-linecap="round"
                        stroke-linejoin="round"
                        d="M9.813 15.904 9 18.75l-.813-2.846a4.5 4.5 0 0 0-3.09-3.09L2.25 12l2.846-.813a4.5 4.5 0 0 0 3.09-3.09L9 5.25l.813 2.846a4.5 4.5 0 0 0 3.09 3.09L15.75 12l-2.846.813a4.5 4.5 0 0 0-3.09 3.09ZM18.259 8.715 18 9.75l-.259-1.035a3.375 3.375 0 0 0-2.455-2.456L14.25 6l1.036-.259a3.375 3.375 0 0 0 2.455-2.456L18 2.25l.259 1.035a3.375 3.375 0 0 0 2.456 2.456L21.75 6l-1.035.259a3.375 3.375 0 0 0-2.456 2.456ZM16.894 20.567 16.5 21.75l-.394-1.183a2.25 2.25 0 0 0-1.423-1.423L13.5 18.75l1.183-.394a2.25 2.25 0 0 0 1.423-1.423l.394-1.183.394 1.183a2.25 2.25 0 0 0 1.423 1.423l1.183.394-1.183.394a2.25 2.25 0 0 0-1.423 1.423Z"
                      />
                    </svg>
                    New
                  </div>
                </div>
                <form action="/toggleSaveProductForUser" method="post">
                  <div
                    class="absolute top-4 right-4 bg-white w-7 h-7 rounded-full flex justify-center items-center shadow-md"
                  >
                    <input
                      type="hidden"
                      name="productId"
                      th:value="${product.productId}"
                    />

                    <button type="submit">
                      <svg
                        xmlns="http://www.w3.org/2000/svg"
                        viewBox="0 0 24 24"
                        fill="currentColor"
                        th:style="'color: ' + (${savedStatusMap[product.productId]} ? '#d11a2a' : '#9CA3AF')"
                        class="w-4"
                      >
                        <path
                          d="m11.645 20.91-.007-.003-.022-.012a15.247 15.247 0 0 1-.383-.218 25.18 25.18 0 0 1-4.244-3.17C4.688 15.36 2.25 12.174 2.25 8.25 2.25 5.322 4.714 3 7.688 3A5.5 5.5 0 0 1 12 5.052 5.5 5.5 0 0 1 16.313 3c2.973 0 5.437 2.322 5.437 5.25 0 3.925-2.438 7.111-4.739 9.256a25.175 25.175 0 0 1-4.244 3.17 15.247 15.247 0 0 1-.383.219l-.022.012-.007.004-.003.001a.752.752 0 0 1-.704 0l-.003-.001Z"
                        />
                      </svg>
                    </button>
                  </div>
                </form>
              </div>
              <div class="p-2">
                <p
                  class="text-lg font-semibold pb-2"
                  th:text="${product.name}"
                ></p>
                <div class="flex gap-2">
                  <p
                    th:text="${product.price + ' EUR'}"
                    class="text-[#d11a2a] text-lg"
                  ></p>
                  <p
                    th:text="${#numbers.formatDecimal(product.price * 1.5, 1, 2) + ' EUR'}"
                    class="self-end line-through text-sm pb-0.5"
                  ></p>
                </div>
              </div>
            </a>
          </div>
        </div>
      </div>
    </main>
    <th:block th:insert="~{fragments/footer :: footer}"></th:block>
  </body>
</html>
